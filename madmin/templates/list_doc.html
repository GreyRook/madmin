{% extends '_layout.html' %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" type="text/css" href="{{ static('css/jsoneditor-min.css') }}">
    <script type="text/javascript" src="{{ static('js/jsoneditor-min.js') }}"></script>
    <script type="text/javascript" src="{{ static('js/ace/ace.js') }}"></script>
    <script type="text/javascript" src="{{ static('js/ace/mode-json.js') }}"></script>
    <script type="text/javascript" src="{{ static('js/ace/theme-textmate.js') }}"></script>
    <script type="text/javascript" src="{{ static('js/ace/theme-jsoneditor.js') }}"></script>
    <script type="text/javascript" src="{{ static('js/jsonlint/jsonlint.js') }}"></script>
{% endblock %}

{% block content %}
<!--  Breadcrumbs  -->

<!--  Toolbar  -->
<div class="input-append row-fluid control-group error" id="simple-editor">
    <input type='text' id='query' name='query' value='{{ query }}' placeholder='Filter in this collection' class="span10" />
    <a href="#" class="btn" title="Extended editor" id="extend-editor"><i class="icon-chevron-down"></i></a>
</div>

<div class="row-fluid hide" id="extended-editor">
    <div id="extended-editor-editor" style="height: 300px;" class="span10"></div>
    <a href="#" class="btn" title="Collapse to simple editor" id="collapse-editor"><i class="icon-chevron-up"></i></a>
</div>

<div class="btn-toolbar row-fluid">
  <div class="btn-group">
    <a title="New document" class="btn btn-success" href="{{ url_for(handler.create_document, db_name=current_db, col_name=current_col) }}">
        <i class="icon-plus icon-white"></i> Create new document
    </a>
    <a title="Delete selected documents" class="btn btn-danger" href="#" id="delete-selected-docs">
        <i class="icon-trash icon-white"></i> Delete selected
    </a>
  </div>
</div>

<form id="delete-docs-form" method="post" action="{{ url_for(handler.delete_documents, db_name=current_db, col_name=current_col) }}">
<table class="table table-striped table-bordered table-condensed" id="doc-table">
<thead>
<tr>
    <th>
        <div class="btn-group">
          <a class="btn btn-mini dropdown-toggle" title="Select documents..." data-toggle="dropdown" href="#">
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="#" id="select-all">All</a></li>
            <li><a href="#" id="select-none">None</a></li>
            <li><a href="#" id="invert-selection">Invert</a></li>
          </ul>
        </div>
    </th>
    <th></th>
    <th>_id</th>
    <th class="stretch">Document</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</form>
<!-- Modal -->
<div id="confirm-delete" class="modal hide fade" tabindex="-1" role="dialog">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Confirm Deletion</h3>
  </div>
  <div class="modal-body">
    <p>Really delete the <span id="selection-size"></span> selected documents? This action cannot be undone!</p>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
    <button class="btn btn-danger" id="confirm-delete-ok"><i class="icon-trash icon-white"></i> Delete selected documents</button>
  </div>
</div>

{% block script %}
    <script>
        var del_url = "{{ url_for(handler.edit_document, db_name=current_db, col_name=current_col, doc='') }}";
        function addRowControls(nRow, aData, iDataIndex) {
            $('td:nth-child(1)', nRow).html('<input title="Mark for deletion" type="checkbox" class="row-selector" name="selected-docs" value="'+ aData[2] +'"/>');
            $('td:nth-child(2)', nRow).html('<a title="Edit this document" class="btn btn-mini" href="'+ del_url + aData[2] +'"><i class="icon-edit"></i></a>');
        }

        $(function () { $("input,select,textarea").not("[type=submit]").jqBootstrapValidation(); } );

        /* Table initialisation */
        $(document).ready(function() {
            $('#doc-table').dataTable( {
                "sPaginationType": "bootstrap",
                "bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": "{{ url_for(handler.json_table, db_name=current_db, col_name=current_col) }}",
                "oLanguage": {
                    "sLengthMenu": "_MENU_ Entries per page",
                    "sZeroRecords": "Nothing found - sorry",
                    "sInfo": "Entries _START_ to _END_ of _TOTAL_",
                    "sInfoEmpty": "Showing 0 to 0 of 0 records",
                    "sInfoFiltered": "(filtered from _MAX_ total records)",
                },
                "fnCreatedRow": addRowControls,
                "fnServerParams": function (aoData) {
                    aoData.push({"name": "query", "value": window.current_query});
                },
                {# Disable sorting on first two columns. #}
                "aoColumnDefs": [
                  { "bSortable": false, "aTargets": [0, 1]}],
                "fnDrawCallback" : table_rendered,
            });
        } );
        
    </script>
    <script src="{{ static('js/jquery.dataTables.min.js') }}"></script>
    <script src="{{ static('js/jquery.dataTables.reload.js') }}"></script>
    <script src="{{ static('js/DT_bootstrap.js') }}"></script>
    <script src="{{ static('js/jqBootstrapValidation.js') }}"></script>

{% endblock %}

{% endblock %}
